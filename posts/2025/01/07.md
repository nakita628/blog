---
date: 2025-01-07
title: OpenAPI
description: OpenAPI
tags: 
    - OpenAPI
    - hono-takibi
prev:
    text: React TanStack Router
    link: /posts/2025/01/06
next:
    text: Hono React
    link: /posts/2025/01/28
---

# OpenAPI

## OAS

&emsp;`OpenAPI Specification(OAS)`ã¯ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã«ä¾å­˜ã—ãªã„`REST API`è¨˜è¿°ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‚ä»¥å‰ã¯`Swagger Specification`ã¨å‘¼ã°ã‚Œã¦ã„ã‚‹ã€‚


* [OpenAPI Specification(OAS)](https://www.openapis.org/)

* [OpenAPI-Specification](https://github.com/OAI/OpenAPI-Specification)

## `YAML`ã¨`JSON`

:::tabs
== YAML
```yaml
simple-property: a simple value

object-property:
  a-property: a value
  another-property: another value

array-property:
  - item-1-property-1: one
    item-1-property-2: 2
  - item-2-property-1: three
    item-2-property-2: 4

# YAMLã®ã‚³ãƒ¡ãƒ³ãƒˆ
```
== JSON
```json
{
  "simple-property": "a simple value",
  "object-property": {
    "a-property": "a value",
    "another-property": "another value"
  },
  "array-of-objects": [
    {
      "item-1-property-1": "one",
      "item-1-property-2": 2
    },
    {
      "item-2-property-1": "three",
      "item-2-property-2": 4
    }
  ]
}
```
:::

* `YAML`ã§ã¯ã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£åã¨äºŒé‡å¼•ç”¨ç¬¦(`" "`)ã§å›²ã¾ãªã„

* `YAML`ã§ã¯ã€JSONã®æ³¢æ‹¬å¼§(`{}`)ã¨ã‚³ãƒ³ãƒ(`,`)ã‚’æ”¹è¡Œã‚„ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã«ç½®ãæ›ãˆ

* `YAML`ã§ã¯ã€é…åˆ—ã®é‰¤æ‹¬å¼§(`{}`)ã¨ã‚³ãƒ³ãƒ(`,`)ã‚’ãƒã‚¤ãƒ•ãƒ³(`-`)ã¨æ”¹è¡Œã«ç½®ãæ›ãˆ

* `JSON`ã¨ç•°ãªã‚Šã€`YAML`ã§ã¯ã€ãƒãƒƒã‚·ãƒ¥è¨˜å·(`#`)ã§å§‹ã¾ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ å¯èƒ½


> YAMLãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’JSONã«å¤‰æ›ã™ã‚‹ã¨ã€ã‚³ãƒ¡ãƒ³ãƒˆãŒæ¶ˆãˆã¦ã—ã¾ã†ç‚¹ã«æ³¨æ„

## `OAS`è¨˜è¿°ãƒ„ãƒ¼ãƒ«

* [Swagger Editor](https://editor.swagger.io/)

* [Redoc](https://github.com/Redocly/redoc)

## `OAS`ãƒ„ãƒ¼ãƒ«

* [OpenAPI Tools](https://openapi.tools/)

&emsp; æœ€å°é™ã®`OAS`ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

:::code-group
```yaml [openapi.yaml]
openapi: "3.0.0"
# APIã®ä¸€èˆ¬æƒ…å ±
info:
  title: API
  version: "1.0"
# ç©ºã®ãƒ‘ã‚¹
paths: {}
```
:::

&emsp;`ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿`ã®è¨˜è¿°

:::code-group
```yaml [openapi.yaml]
paths:
  /posts:
    get:
      tags:
        - Post
      summary: Retrieve a list of posts
      description: Retrieve a paginated list of posts. Specify the page number and the number of posts per page.
      parameters:
        - name: page      # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®åå‰
          in: query       # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å ´æ‰€
          required: true  # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå¿…é ˆã‹ã©ã†ã‹
          schema:         # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®èª¬æ˜
            type: integer # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å‹(æ•´æ•°)
            minimum: 0
            default: 1
            example: 1
          description: The page number to retrieve. Must be a positive integer. Defaults to 1.
        - name: rows
          in: query
          required: true
          schema:
            type: integer
            minimum: 0
            default: 10
            example: 10
          description: The number of posts per page. Must be a positive integer. Defaults to 10.
```
:::

&emsp;`ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿`ã®è¨˜è¿°

:::code-group
```yaml [openapi.yaml]
paths:
  /posts/{id}:           # ãƒªã‚½ãƒ¼ã‚¹ã®ãƒ‘ã‚¹ã¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
    delete:              # å‰Šé™¤ã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
      tags:
        - Post
      summary: Delete a post
      description: Delete an existing post identified by its unique ID.
      parameters:        # å‰Šé™¤ã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
        - name: id       # ãƒ‘ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®åå‰
          in: path       # ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ãƒ‘ã‚¹ã«é…ç½®ã•ã‚Œã‚‹
          required: true # å¿…é ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
          schema:
            type: string
            format: uuid
            example: 123e4567-e89b-12d3-a456-426614174000
          description: Unique identifier of the post.
```
:::

&emsp; `OAS`ã¨`JSON Schema`ã‚’ä½¿ç”¨ã—`API`ãƒ‡ãƒ¼ã‚¿ã‚’è¨˜è¿°

* [JSON Schema](https://json-schema.org/)

:::code-group
```yaml [openapi.yaml]
type: object      # ã“ã®ã‚¹ã‚­ãƒ¼ãƒã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¨˜è¿°
properties:       # ã“ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’å«ã‚“ã§ã„ã‚‹
  reference:      # ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®è¨˜è¿°
    type: string: # ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å‹
  name:           # ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®åå‰
    type: string  # ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å‹
  property-name:  # ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®åå‰
    type: number  # ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å‹
```
:::

&emsp;`Error`ã‚¹ã‚­ãƒ¼ãƒã‚„`Post`ã‚¹ã‚­ãƒ¼ãƒã‚’`components`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§è¨˜è¿°ã—ã€è¤‡æ•°è¨˜è¿°ã‚’é¿ã‘ã€`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ`ã‚’å†åˆ©ç”¨

:::code-group
```yaml [openapi.yaml]
openapi: 3.1.0
info:
  title: Hono API
  version: v1

components:
  schemas:
    Error:
      type: object
      properties:
        message:
          type: string
      required:
        - message
    Post:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier of the post
        post:
          type: string
          description: Content of the post
          minLength: 1
          maxLength: 140
        createdAt:
          type: string
          format: date-time
          description: Timestamp when the post was created
        updatedAt:
          type: string
          format: date-time
          description: Timestamp when the post was last updated
      required:
        - id
        - post
        - createdAt
        - updatedAt

tags:
  - name: Hono
    description: Endpoints related to general Hono operations
  - name: Post
    description: Endpoints for creating, retrieving, updating, and deleting posts

paths:
  /:
    get:
      tags:
        - Hono
      summary: Welcome message
      description: Retrieve a simple welcome message from the Hono API.
      responses:
        '200':
          description: Successful response with a welcome message.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: HonoğŸ”¥
                required:
                  - message

  /posts:
    post:
      tags:
        - Post
      summary: Create a new post
      description: Submit a new post with a maximum length of 140 characters.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                post:
                  type: string
                  description: Content of the post
                  minLength: 1
                  maxLength: 140
              required:
                - post
            example:
              post: "This is my first post!"
      responses:
        '201':
          description: Post successfully created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: Created
        '400':
          description: Invalid request due to bad input.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: Post content is required and must be between 1 and 140 characters.
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: An unexpected error occurred. Please try again later.

    get:
      tags:
        - Post
      summary: Retrieve a list of posts
      description: Retrieve a paginated list of posts. Specify the page number and the number of posts per page.
      parameters:
        - in: query
          name: page
          required: true
          schema:
            type: integer
            minimum: 0
            default: 1
            example: 1
          description: The page number to retrieve. Must be a positive integer. Defaults to 1.
        - in: query
          name: rows
          required: true
          schema:
            type: integer
            minimum: 0
            default: 10
            example: 10
          description: The number of posts per page. Must be a positive integer. Defaults to 10.
      responses:
        '200':
          description: Successfully retrieved a list of posts.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Post'
              example:
                - id: "123e4567-e89b-12d3-a456-426614174000"
                  post: "Hello world!"
                  createdAt: "2024-12-01T12:34:56Z"
                  updatedAt: "2024-12-02T14:20:00Z"
        '400':
          description: Invalid request due to bad input.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: Invalid page or rows parameter. Both must be positive integers.
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: An unexpected error occurred. Please try again later.

  /posts/{id}:
    put:
      tags:
        - Post
      summary: Update an existing post
      description: Update the content of an existing post identified by its unique ID.
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
          description: Unique identifier of the post.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                post:
                  type: string
                  description: Updated content for the post
                  minLength: 1
                  maxLength: 140
              required:
                - post
            example:
              post: "Updated post content."
      responses:
        '204':
          description: Post successfully updated.
        '400':
          description: Invalid input.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: Post content is required and must be between 1 and 140 characters.
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: An unexpected error occurred. Please try again later.

    delete:
      tags:
        - Post
      summary: Delete a post
      description: Delete an existing post identified by its unique ID.
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            format: uuid
            example: 123e4567-e89b-12d3-a456-426614174000
          description: Unique identifier of the post.
      responses:
        '204':
          description: Post successfully deleted.
        '400':
          description: Invalid input.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: Invalid post ID.
        '500':
          description: Internal server error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              example:
                message: An unexpected error occurred. Please try again later.
```
:::

## Directory Structure

```
.
â””â”€â”€ openapi.yaml
```

## Command

:::code-group
```sh [npm]
npx hono-takibi openapi.yaml -o index.ts
```
:::

## Generated

```
.
â”œâ”€â”€ index.ts
â””â”€â”€ openapi.yaml
```

&emsp;generated code

:::code-group
```ts [index.ts]
import { createRoute, z } from '@hono/zod-openapi'

const ErrorSchema = z.object({ message: z.string() }).openapi('Error')

const PostSchema = z
  .object({
    id: z.string().uuid(),
    post: z.string().min(1).max(140),
    createdAt: z.string().datetime(),
    updatedAt: z.string().datetime(),
  })
  .openapi('Post')

export const getRoute = createRoute({
  tags: ['Hono'],
  method: 'get',
  path: '/',
  summary: 'Welcome message',
  description: 'Retrieve a simple welcome message from the Hono API.',
  responses: {
    200: {
      description: 'Successful response with a welcome message.',
      content: {
        'application/json': {
          schema: z.object({ message: z.string().openapi({ example: 'HonoğŸ”¥' }) }),
        },
      },
    },
  },
})

export const postPostsRoute = createRoute({
  tags: ['Post'],
  method: 'post',
  path: '/posts',
  summary: 'Create a new post',
  description: 'Submit a new post with a maximum length of 140 characters.',
  request: {
    body: {
      required: true,
      content: { 'application/json': { schema: z.object({ post: z.string().min(1).max(140) }) } },
    },
  },
  responses: {
    201: {
      description: 'Post successfully created.',
      content: { 'application/json': { schema: ErrorSchema } },
    },
    400: {
      description: 'Invalid request due to bad input.',
      content: { 'application/json': { schema: ErrorSchema } },
    },
    500: {
      description: 'Internal server error.',
      content: { 'application/json': { schema: ErrorSchema } },
    },
  },
})

export const getPostsRoute = createRoute({
  tags: ['Post'],
  method: 'get',
  path: '/posts',
  summary: 'Retrieve a list of posts',
  description:
    'Retrieve a paginated list of posts. Specify the page number and the number of posts per page.',
  request: {
    query: z.object({
      page: z.string().pipe(z.coerce.number().int().min(0).default(1).openapi({ example: 1 })),
      rows: z.string().pipe(z.coerce.number().int().min(0).default(10).openapi({ example: 10 })),
    }),
  },
  responses: {
    200: {
      description: 'Successfully retrieved a list of posts.',
      content: { 'application/json': { schema: z.array(PostSchema) } },
    },
    400: {
      description: 'Invalid request due to bad input.',
      content: { 'application/json': { schema: ErrorSchema } },
    },
    500: {
      description: 'Internal server error.',
      content: { 'application/json': { schema: ErrorSchema } },
    },
  },
})

export const putPostsIdRoute = createRoute({
  tags: ['Post'],
  method: 'put',
  path: '/posts/{id}',
  summary: 'Update an existing post',
  description: 'Update the content of an existing post identified by its unique ID.',
  request: {
    body: {
      required: true,
      content: { 'application/json': { schema: z.object({ post: z.string().min(1).max(140) }) } },
    },
    params: z.object({ id: z.string().uuid() }),
  },
  responses: {
    204: { description: 'Post successfully updated.' },
    400: {
      description: 'Invalid input.',
      content: { 'application/json': { schema: ErrorSchema } },
    },
    500: {
      description: 'Internal server error.',
      content: { 'application/json': { schema: ErrorSchema } },
    },
  },
})

export const deletePostsIdRoute = createRoute({
  tags: ['Post'],
  method: 'delete',
  path: '/posts/{id}',
  summary: 'Delete a post',
  description: 'Delete an existing post identified by its unique ID.',
  request: {
    params: z.object({
      id: z
        .string()
        .uuid()
        .openapi({
          param: { name: 'id', in: 'path' },
          example: '123e4567-e89b-12d3-a456-426614174000',
        }),
    }),
  },
  responses: {
    204: { description: 'Post successfully deleted.' },
    400: {
      description: 'Invalid input.',
      content: { 'application/json': { schema: ErrorSchema } },
    },
    500: {
      description: 'Internal server error.',
      content: { 'application/json': { schema: ErrorSchema } },
    },
  },
})
```
:::